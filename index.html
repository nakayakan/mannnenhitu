<!DOCTYPE html>

<html lang="ja">
<head>
  <meta charset="utf-8">

  <title>万年筆の自由帳</title>
  <meta name="description" content="The HTML5 Herald">
  <meta name="author" content="SitePoint">

  <link rel="stylesheet" href="stylesheet.css">

  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>

<body>
  <script src="js/jquery-3.2.1.min.js"></script>
  <ul>
  <li><a href="miryoku/index.html" class="miryoku"><img src="images/charm.png" alt="万年筆の育て方" style="width: 28px"/></a></li>
  <li><a href="kaku/index.html" class="kaku"><img src="images/draw.png" alt="万年筆で描く"/></a></li>
  <li><a href="info/index.html" class="info"><img src="images/about.png" alt="このサイトについて" style="width: 35px"/></a></li>
  </ul>
  <a href="index.html" class="logo"><img src="images/logo.png" class="logoimg" alt=""></a>
  <div class="memo"><img src="images/memo.png" alt=""></div>

  <div class="contents">
    <div class="wrapper">
      <video src="images/backmovie1.mp4" id="video"></video>
      <img src="images/test.png" alt="Placeholder" id='img'>
      <div id="frames">
        <div class="frame1 debug-mode" id="img1"    data-timing="500"   data-pen="pen1">1</div>
        <div class="frame1 debug-mode" id="img2"    data-timing="3000"  data-pen="pen1">2</div>
        <div class="frame1 debug-mode" id="img3"    data-timing="5000"  data-pen="pen1">3</div>
        <div class="frame2 debug-mode" id="img4"    data-timing="9200"  data-pen="pen2">4</div>
        <div class="frame2 debug-mode" id="img5"    data-timing="14000" data-pen="pen2">5</div>
        <div class="frame2 debug-mode" id="img6"    data-timing="18000" data-pen="pen2">6</div>
        <div class="frame2 debug-mode" id="img7"    data-timing="21000" data-pen="pen2">7</div>
        <div class="frame2 debug-mode" id="img8"    data-timing="26000" data-pen="pen2">8</div>
        <div class="frame2 debug-mode" id="img9"    data-timing="31000" data-pen="pen2">9</div>
        <div class="frame3 debug-mode" id="img10"   data-timing="35000" data-pen="pen3">10</div>
        <div class="frame3 debug-mode" id="img101"  data-timing="37000" data-pen="pen3">10.1</div>
        <div class="frame3 debug-mode" id="img102"  data-timing="41000" data-pen="pen3">10.2</div>
        <div class="frame3 debug-mode" id="img11"   data-timing="43000" data-pen="pen3">11</div>
        <div class="frame3 debug-mode" id="img12"   data-timing="46000" data-pen="pen3">12</div>
        <div class="frame3 debug-mode" id="img13"   data-timing="49000" data-pen="pen3">13</div>
        <div class="frame4 debug-mode" id="img14"   data-timing="52000" data-pen="pen4">14</div>
        <div class="frame4 debug-mode" id="img141"  data-timing="54500" data-pen="pen4">14.1</div>
        <div class="frame4 debug-mode" id="img142"  data-timing="56500" data-pen="pen4">14.2</div>
        <div class="frame4 debug-mode" id="img15"   data-timing="57500" data-pen="pen4">15</div>
        <div class="frame4 debug-mode" id="img16"   data-timing="60000" data-pen="pen4">16</div>
        <div class="frame5 debug-mode" id="img17"   data-timing="67000" data-pen="pen5">17</div>
        <div class="frame2 debug-mode" id="img18"   data-timing="72000" data-pen="pen2">18</div>
        <div class="frame2 debug-mode" id="img181"  data-timing="79000" data-pen="pen2">18.1</div>
        <div class="frame2 debug-mode" id="img182"  data-timing="83000" data-pen="pen2">18.2</div>
        <div class="frame2 debug-mode" id="img19"   data-timing="86500" data-pen="pen2">19</div>
        <div class="frame2 debug-mode" id="img20"   data-timing="89000" data-pen="pen2">20</div>
        <div class="frame2 debug-mode" id="img21"   data-timing="93000" data-pen="pen2">21</div>
        <div class="frame2 debug-mode" id="img22"   data-timing="96000" data-pen="pen2">22</div>
        <div class="frame2 debug-mode" id="img221"  data-timing="96000" data-pen="pen2">22.1</div>
        <div class="frame3 debug-mode" id="img23"   data-timing="100000"data-pen="pen3">23</div>
        <div class="frame2 debug-mode" id="img24"   data-timing="105000"data-pen="pen2">24</div>
      </div>
    </div>
  </div>
<div class="pen1 pen">
  <img src="images/pen1.png" alt="">
    <img src="images/pen1_info.jpg" alt="" class="peninfo">
</div>
<div class="pen2 pen">
  <img src="images/pen2.png" alt="">
  <img src="images/pen2_info.jpg" alt="" class="peninfo">
</div>
<div class="pen3 pen">
  <img src="images/pen3.png" alt="">
  <img src="images/pen3_info.jpg" alt="" class="peninfo">
</div>
<div class="pen4 pen">
  <img src="images/pen4.png" alt="">
  <img src="images/pen4_info.jpg" alt="" class="peninfo">
</div>
<div class="pen5 pen">
  <img src="images/pen5.png" alt="">
  <img src="images/pen5_info.jpg" alt="" class="peninfo">
</div>

  <div class="button">
    <img src="images/skip.png" alt="">
  </div>

<script>
function hideFrames() {
  $('#frames').children('div').hide()
}

var $video = $('#video')
$video.on('ended', function() {
  hideFrames()
  this.play()
})

$video.on('timeupdate', function() {
  var currentTime = this.currentTime * 1000
  $('#frames').children('div').each(function() {
    var $target = $(this)
    if($target.data('timing') <= currentTime ) $target.show()
  })
})

$video[0].play()

var timeOutMS = 100

var flags = {}

function formatPenZIndex(forward) {
  for(var i = 1; i <= 5; i++) {
    var className = `.pen${i}`
    if(forward == className) $(className).css('z-index', 100)
    else $(className).css('z-index', 1)
  }
}

var prevMouseoverElem = null

function isSamePen(elem1, elem2) {
  return $(elem1).data('pen') == $(elem2).data('pen')
}

var mouseoutEventId = 0
$('#frames div').mouseover(function() {
  if(isSamePen(this, prevMouseoverElem)) {
    clearTimeout(mouseoutEventId)
    return
  }
  var pen = '.' + $(this).data('pen')
  $(pen).addClass('pen-active')
  formatPenZIndex(pen)
  prevMouseoverElem = this
})

$('#frames div').mouseout(function() {
  var pen = $(this).data('pen')
  if(isSamePen(this, prevMouseoverElem)) {
    mouseoutEventId = setTimeout(function() {
      $('.' + pen).removeClass('pen-active')
      prevMouseoverElem = null
    }, 300)
  } else {
    $('.' + pen).removeClass('pen-active')
    prevMouseoverElem = null
  }
})

var video = document.getElementById('video');
$(function() {
    $('.button').click(function(){
      //動画を停止
        video.pause();
        video.currentTime = 0;
      // 背景動画を非表示
        $("#video").toggle(false);
        $('#img').css('display', 'inline-block');
        $('.frame1').show();
        $('.frame2').show();
        $('.frame3').show();
        $('.frame4').show();
        $('.frame5').show();
    });
});

</script>
</body>
</html>
